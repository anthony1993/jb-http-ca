<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Custom Journey Builder Activity</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="colorbox.css" />    
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.serializejson.js"></script>
    <script type="text/javascript" src="js/require.js"></script>
    <script type="text/javascript" src="js/jquery.colorbox-min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    
    <script>
        $(document).ready(function(){
            $(".inline").colorbox({inline:true, width:"50%"});   
            $('.non-retina').colorbox({rel:'group5', transition:'none'})
            $('.retina').colorbox({rel:'group5', transition:'none', retinaImage:true, retinaUrl:true});   
        });                
    </script>
    <script type="text/javascript">
        (function() {
            var config = {
                baseUrl: ''
            };

            var dependencies = [
                'customActivity'
            ];

            require(config, dependencies);
        })();
    </script>

    <script type="text/javascript">
         function showhide(id) {
            var e = document.getElementById(id);
            e.style.display = (e.style.display == 'block') ? 'none' : 'block';
         }                    
    </script>
</head>
<body>

    <!--<a href="javascript:showhide('firstCall')">
        Click to show/hide first div.
    </a>
    </br>    
    <a href="javascript:showhide('secondCall')">
        Click to show/hide second div.
    </a>-->
    
<div id="firstCall" class="step">
    <form id="authenticationForm">
        Authentication Mechanism:
        <select name="requestAuthentication" id="select1">
            <option value="">Select an option</option>
            <option value="none">None</option>                                                
            <option value="oauth">OAuth</option>
            <option value="jwt">JWT</option>
            <option value="custom">Roadmap</option>
        </select>
    </form>
</div>

<div id="secondCall" class="step">
  <form id="requestForm">
    Using Authentication Type: <div id="authType"></div>
    <div class="urlProperties">
        <select name="methodType" id="methodType">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="PATCH">PATCH</option>
            <option value="DELETE">DELETE</option>
            <option value="COPY">COPY</option>
            <option value="HEAD">HEAD</option>
            <option value="OPTIONS">OPTIONS</option>
            <option value="LINK">LINK</option>
            <option value="UNLINK">UNLINK</option>
            <option value="PURGE">PURGE</option>
            <option value="LOCK">LOCK</option>
            <option value="UNLOCK">UNLOCK</option>
            <option value="PROPFIND">PROPFIND</option>
            <option value="VIEW">VIEW</option>
        </select>
        
        <input type="text" id="requestUrl" name="requestUrl" size="100" aria-placeholder="Enter request URL here">        
        <button type="button" id="testButton" class="button">Test</button>
        
    </div>
    <div class="requestProperties">
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#headers">Headers</a></li>
            <li><a data-toggle="tab" href="#requestConfig">Body</a></li>
        </ul>

        <div class="tab-content">
            <div id="headers" class="tab-pane fade in active">
                <h3>Headers</h3>
                <table id="headerTable">
                    <tr>
                        <td id="header1"><input type="text" size="35" name="header[1]" placeholder="Header"></td>
                        <td id="value1"><input size="35" type="text" name="value[1]" placeholder="Value"></td>
                   </tr>
                </table>
            </div>
            
            <div id="requestConfig" class="tab-pane fade">
                <h3>Body</h3>
                <textarea name="requestBody" id="requestBody" rows="20" cols="80"></textarea>
            </div>
        </div>
    </div>
  </form>
  
</div>

     <!--This contains the hidden content for inline calls 
    <div style='display:none'>
        <div id='inline_content' style='padding:10px; background:#fff;'>
        <p><strong>This content comes from a hidden element on this page.</strong></p>
        <p>The inline option preserves bound JavaScript events and changes, and it puts the content back where it came from when it is closed.</p>
        <p><a id="click" href="#" style='padding:5px; background:#ccc;'>Click me, it will be preserved!</a></p>
        
        <p><strong>If you try to open a new Colorbox while it is already open, it will update itself with the new content.</strong></p>
        <p>Updating Content Example:<br />
        <a class="ajax" href="../content/ajax.html">Click here to load new content</a></p>
        </div>
    </div>-->
<script>    

$('#testButton').click( function() {

    $.ajax({
        method: 'POST',
        dataType: 'json',
        url: 'https://polar-taiga-52256.herokuapp.com/testRequestConfig',
        data: JSON.stringify($('#requestForm').serializeJSON())})
        .done(function(data) { 
            console.log(JSON.stringify($('#requestForm').serializeJSON()));
            var message = "Configuration JSON: </br>";
            message += JSON.stringify(data);
            jQuery.colorbox({html:message}) 
        })
        .fail(function(data) { alert(data); })
        .always(function(data) { console.log("test request completed") });

    });
        
    /* If clicked into the header or value box, add a row if there are no other empty rows */    
    var i = 2;
        
    var clickInputHandler = function () {
        var trId = "trHeaderValue" + i;
        var headerName = "header";
        var valueName = "value";
        var imageName = "img" + i;
        
        var data = '<tr id="' + trId + '"><td id="' + headerName + '"><input type="text" size="35" name="' + headerName + '[' + i + ']' +
                            '" placeholder="Header"></td><td id="' + valueName + 
                            '"><input type="text" size="35" name="' + valueName + '[' + i + ']' + '" placeholder="Value"></td><td id="' + imageName + 
                            '"><img src="images/delete.png" height="20px" width="20px"></td></tr>';
               
       $( "#headerTable" ).last().append(data);
        
       $(this).unbind('click.handler');

       var jHeaderName = "input[name='header[" + i + "]']"
       
       $(jHeaderName).unbind('click.handler').bind('click.handler', clickInputHandler);
       $("#" + imageName).unbind('click.handler').bind('click.handler', imageClickHandler);
       
       i++;          
    };

    var imageClickHandler = function () {
        // delete this row from the table
        if($(this).closest("tr").is(":last-child")) {
           // turn off the previous tds!
           $(this).closest("tr").prev().children().eq(0).unbind('click.handler').bind('click.handler', clickInputHandler);     
        }        
        // console.log("remove parent");
        $(this).parent().remove();               
    };
           
    $( "#header1" ).bind('click.handler', clickInputHandler);
</script>
</body>
</html>
